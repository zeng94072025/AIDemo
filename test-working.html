<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圖片處理功能測試</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f7;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056CC;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .image-item {
            text-align: center;
        }
        .image-item img {
            max-width: 100%;
            max-height: 200px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>圖片處理功能測試</h1>
        
        <div class="section">
            <h3>1. 上傳圖片</h3>
            <input type="file" id="imageInput" accept="image/*">
            <div id="uploadLog" class="log"></div>
        </div>
        
        <div class="section">
            <h3>2. 基礎處理測試</h3>
            <button class="button" id="brightnessBtn" onclick="testBrightness()" disabled>亮度調整</button>
            <button class="button" id="contrastBtn" onclick="testContrast()" disabled>對比度調整</button>
            <button class="button" id="grayscaleBtn" onclick="testGrayscale()" disabled>黑白濾鏡</button>
            <button class="button" id="sepiaBtn" onclick="testSepia()" disabled>復古濾鏡</button>
            <button class="button" id="invertBtn" onclick="testInvert()" disabled>反轉濾鏡</button>
            <div id="basicLog" class="log"></div>
        </div>
        
        <div class="section">
            <h3>3. 高級濾鏡測試</h3>
            <button class="button" id="blurBtn" onclick="testBlur()" disabled>模糊濾鏡</button>
            <button class="button" id="sharpenBtn" onclick="testSharpen()" disabled>銳化濾鏡</button>
            <button class="button" id="vintageBtn" onclick="testVintage()" disabled>懷舊濾鏡</button>
            <button class="button" id="warmBtn" onclick="testWarm()" disabled>暖色調</button>
            <button class="button" id="coolBtn" onclick="testCool()" disabled>冷色調</button>
            <div id="filterLog" class="log"></div>
        </div>
        
        <div class="section">
            <h3>4. 相框效果測試</h3>
            <button class="button" id="classicFrameBtn" onclick="testClassicFrame()" disabled>經典相框</button>
            <button class="button" id="modernFrameBtn" onclick="testModernFrame()" disabled>現代相框</button>
            <button class="button" id="artisticFrameBtn" onclick="testArtisticFrame()" disabled>藝術相框</button>
            <div id="frameLog" class="log"></div>
        </div>
        
        <div class="section">
            <h3>5. 圖片預覽</h3>
            <div id="imageGrid" class="image-grid"></div>
        </div>
    </div>

    <!-- 引入JavaScript文件 -->
    <script src="js/utils.js"></script>
    <script src="js/downloadFixedImageProcessor.js"></script>
    
    <script>
        let processor = null;
        let originalImage = null;
        
        // 日誌函數
        function log(message, type = 'info', target = 'uploadLog') {
            const logDiv = document.getElementById(target);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // 啟用按鈕
        function enableButtons() {
            const buttons = [
                'brightnessBtn', 'contrastBtn', 'grayscaleBtn', 'sepiaBtn', 'invertBtn',
                'blurBtn', 'sharpenBtn', 'vintageBtn', 'warmBtn', 'coolBtn',
                'classicFrameBtn', 'modernFrameBtn', 'artisticFrameBtn'
            ];
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = false;
            });
        }
        
        // 顯示圖片
        function showImage(title, base64, targetId = 'imageGrid') {
            const grid = document.getElementById(targetId);
            const item = document.createElement('div');
            item.className = 'image-item';
            item.innerHTML = `
                <h4>${title}</h4>
                <img src="${base64}" alt="${title}">
            `;
            grid.appendChild(item);
        }
        
        // 文件選擇處理
        document.getElementById('imageInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                log('開始載入圖片: ' + file.name);
                
                try {
                    // 創建處理器
                    processor = new DownloadFixedImageProcessor();
                    log('處理器創建成功');
                    
                    // 載入圖片
                    const imageData = await processor.loadImage(file);
                    log('圖片載入成功: ' + imageData.width + 'x' + imageData.height, 'success');
                    
                    // 保存原始圖片
                    originalImage = processor.toBase64();
                    
                    // 顯示原始圖片
                    showImage('原始圖片', originalImage);
                    log('原始圖片顯示成功', 'success');
                    
                    // 啟用按鈕
                    enableButtons();
                    
                } catch (error) {
                    log('圖片載入失敗: ' + error.message, 'error');
                }
            }
        });
        
        // 測試亮度調整
        function testBrightness() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'basicLog');
                return;
            }
            
            log('開始測試亮度調整...', 'info', 'basicLog');
            
            try {
                const success = processor.adjustBrightness(30);
                
                if (success) {
                    log('亮度調整成功', 'success', 'basicLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('亮度調整後', base64);
                    }
                } else {
                    log('亮度調整失敗', 'error', 'basicLog');
                }
            } catch (error) {
                log('亮度調整異常: ' + error.message, 'error', 'basicLog');
            }
        }
        
        // 測試對比度調整
        function testContrast() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'basicLog');
                return;
            }
            
            log('開始測試對比度調整...', 'info', 'basicLog');
            
            try {
                const success = processor.adjustContrast(20);
                
                if (success) {
                    log('對比度調整成功', 'success', 'basicLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('對比度調整後', base64);
                    }
                } else {
                    log('對比度調整失敗', 'error', 'basicLog');
                }
            } catch (error) {
                log('對比度調整異常: ' + error.message, 'error', 'basicLog');
            }
        }
        
        // 測試黑白濾鏡
        function testGrayscale() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'basicLog');
                return;
            }
            
            log('開始測試黑白濾鏡...', 'info', 'basicLog');
            
            try {
                const success = processor.applyFilter('grayscale');
                
                if (success) {
                    log('黑白濾鏡應用成功', 'success', 'basicLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('黑白濾鏡後', base64);
                    }
                } else {
                    log('黑白濾鏡應用失敗', 'error', 'basicLog');
                }
            } catch (error) {
                log('黑白濾鏡異常: ' + error.message, 'error', 'basicLog');
            }
        }
        
        // 測試復古濾鏡
        function testSepia() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'basicLog');
                return;
            }
            
            log('開始測試復古濾鏡...', 'info', 'basicLog');
            
            try {
                const success = processor.applyFilter('sepia');
                
                if (success) {
                    log('復古濾鏡應用成功', 'success', 'basicLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('復古濾鏡後', base64);
                    }
                } else {
                    log('復古濾鏡應用失敗', 'error', 'basicLog');
                }
            } catch (error) {
                log('復古濾鏡異常: ' + error.message, 'error', 'basicLog');
            }
        }
        
        // 測試反轉濾鏡
        function testInvert() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'basicLog');
                return;
            }
            
            log('開始測試反轉濾鏡...', 'info', 'basicLog');
            
            try {
                const success = processor.applyFilter('invert');
                
                if (success) {
                    log('反轉濾鏡應用成功', 'success', 'basicLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('反轉濾鏡後', base64);
                    }
                } else {
                    log('反轉濾鏡應用失敗', 'error', 'basicLog');
                }
            } catch (error) {
                log('反轉濾鏡異常: ' + error.message, 'error', 'basicLog');
            }
        }
        
        // 測試模糊濾鏡
        function testBlur() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'filterLog');
                return;
            }
            
            log('開始測試模糊濾鏡...', 'info', 'filterLog');
            
            try {
                const success = processor.applyFilter('blur');
                
                if (success) {
                    log('模糊濾鏡應用成功', 'success', 'filterLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('模糊濾鏡後', base64);
                    }
                } else {
                    log('模糊濾鏡應用失敗', 'error', 'filterLog');
                }
            } catch (error) {
                log('模糊濾鏡異常: ' + error.message, 'error', 'filterLog');
            }
        }
        
        // 測試銳化濾鏡
        function testSharpen() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'filterLog');
                return;
            }
            
            log('開始測試銳化濾鏡...', 'info', 'filterLog');
            
            try {
                const success = processor.applyFilter('sharpen');
                
                if (success) {
                    log('銳化濾鏡應用成功', 'success', 'filterLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('銳化濾鏡後', base64);
                    }
                } else {
                    log('銳化濾鏡應用失敗', 'error', 'filterLog');
                }
            } catch (error) {
                log('銳化濾鏡異常: ' + error.message, 'error', 'filterLog');
            }
        }
        
        // 測試懷舊濾鏡
        function testVintage() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'filterLog');
                return;
            }
            
            log('開始測試懷舊濾鏡...', 'info', 'filterLog');
            
            try {
                const success = processor.applyFilter('vintage');
                
                if (success) {
                    log('懷舊濾鏡應用成功', 'success', 'filterLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('懷舊濾鏡後', base64);
                    }
                } else {
                    log('懷舊濾鏡應用失敗', 'error', 'filterLog');
                }
            } catch (error) {
                log('懷舊濾鏡異常: ' + error.message, 'error', 'filterLog');
            }
        }
        
        // 測試暖色調
        function testWarm() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'filterLog');
                return;
            }
            
            log('開始測試暖色調...', 'info', 'filterLog');
            
            try {
                const success = processor.applyFilter('warm');
                
                if (success) {
                    log('暖色調應用成功', 'success', 'filterLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('暖色調後', base64);
                    }
                } else {
                    log('暖色調應用失敗', 'error', 'filterLog');
                }
            } catch (error) {
                log('暖色調異常: ' + error.message, 'error', 'filterLog');
            }
        }
        
        // 測試冷色調
        function testCool() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'filterLog');
                return;
            }
            
            log('開始測試冷色調...', 'info', 'filterLog');
            
            try {
                const success = processor.applyFilter('cool');
                
                if (success) {
                    log('冷色調應用成功', 'success', 'filterLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('冷色調後', base64);
                    }
                } else {
                    log('冷色調應用失敗', 'error', 'filterLog');
                }
            } catch (error) {
                log('冷色調異常: ' + error.message, 'error', 'filterLog');
            }
        }
        
        // 測試經典相框
        function testClassicFrame() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'frameLog');
                return;
            }
            
            log('開始測試經典相框...', 'info', 'frameLog');
            
            try {
                const success = processor.applyFrame('classic');
                
                if (success) {
                    log('經典相框應用成功', 'success', 'frameLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('經典相框後', base64);
                    }
                } else {
                    log('經典相框應用失敗', 'error', 'frameLog');
                }
            } catch (error) {
                log('經典相框異常: ' + error.message, 'error', 'frameLog');
            }
        }
        
        // 測試現代相框
        function testModernFrame() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'frameLog');
                return;
            }
            
            log('開始測試現代相框...', 'info', 'frameLog');
            
            try {
                const success = processor.applyFrame('modern');
                
                if (success) {
                    log('現代相框應用成功', 'success', 'frameLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('現代相框後', base64);
                    }
                } else {
                    log('現代相框應用失敗', 'error', 'frameLog');
                }
            } catch (error) {
                log('現代相框異常: ' + error.message, 'error', 'frameLog');
            }
        }
        
        // 測試藝術相框
        function testArtisticFrame() {
            if (!processor) {
                log('請先上傳圖片', 'error', 'frameLog');
                return;
            }
            
            log('開始測試藝術相框...', 'info', 'frameLog');
            
            try {
                const success = processor.applyFrame('artistic');
                
                if (success) {
                    log('藝術相框應用成功', 'success', 'frameLog');
                    const base64 = processor.toBase64();
                    if (base64) {
                        showImage('藝術相框後', base64);
                    }
                } else {
                    log('藝術相框應用失敗', 'error', 'frameLog');
                }
            } catch (error) {
                log('藝術相框異常: ' + error.message, 'error', 'frameLog');
            }
        }
    </script>
</body>
</html> 